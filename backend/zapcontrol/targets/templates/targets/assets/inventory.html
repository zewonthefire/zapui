{% extends 'core/base.html' %}
{% block title %}Assets Inventory{% endblock %}
{% block content %}
<h1 class="h3 mb-3">Assets Inventory</h1>
{% include 'targets/assets/partials/context_bar.html' %}
<div class="table-responsive bg-white rounded shadow-sm">
<table class="table table-sm table-hover mb-0">
  <thead><tr><th>Asset</th><th>Project / Target</th><th>Last scanned</th><th>#Scans</th><th>Risk score</th><th>Trend</th><th>Findings H/M/L</th><th>Scanner / Profile</th></tr></thead>
  <tbody>
  {% for asset in page.object_list %}
    <tr onclick="window.location='/assets/{{ asset.id }}/'" style="cursor:pointer;">
      <td><strong>{{ asset.name }}</strong><br><small class="text-muted">{{ asset.asset_type }}</small></td>
      <td>{{ asset.target.project.name }} / {{ asset.target.name }}</td>
      <td>{{ asset.last_scanned_at|default:'-' }}<br><small>{{ asset.last_scan_status|default:'' }}</small></td>
      <td>{{ asset.scan_count }}</td>
      <td>{{ asset.latest_score|default:asset.current_risk_score }}</td>
      <td>
        {% if asset.previous_score %}
          {{ asset.latest_score|default:asset.current_risk_score|floatformat:2 }} / {{ asset.previous_score|floatformat:2 }}
        {% else %}-{% endif %}
      </td>
      <td>{{ asset.findings_open_count_by_sev.High|default:0 }}/{{ asset.findings_open_count_by_sev.Medium|default:0 }}/{{ asset.findings_open_count_by_sev.Low|default:0 }}</td>
      <td>{{ asset.target.scan_jobs.first.zap_node.name|default:'-' }} / {{ asset.target.scan_jobs.first.profile.name|default:'-' }}</td>
    </tr>
  {% empty %}
    <tr><td colspan="8" class="text-center text-muted py-4">No assets found.</td></tr>
  {% endfor %}
  </tbody>
</table>
</div>
<nav class="mt-3">
  {% if page.has_previous %}<a class="btn btn-outline-secondary btn-sm" href="?page={{ page.previous_page_number }}&{{ request.GET.urlencode }}">Previous</a>{% endif %}
  <span class="mx-2">Page {{ page.number }}/{{ page.paginator.num_pages }}</span>
  {% if page.has_next %}<a class="btn btn-outline-secondary btn-sm" href="?page={{ page.next_page_number }}&{{ request.GET.urlencode }}">Next</a>{% endif %}
</nav>
{% endblock %}
