{% extends "administration/base.html" %}
{% block admin_content %}
<h2 class="h5 mb-3">Groups</h2>

<div class="mb-4">
  <form method="post" class="row g-2 align-items-end">{% csrf_token %}
    <div class="col-sm-8 col-md-6">
      <label class="form-label">New group name</label>
      <input class="form-control" name="name" placeholder="Example: project_payments_scanners" required>
    </div>
    <div class="col-sm-4 col-md-3">
      <button class="btn btn-primary w-100">Create group</button>
    </div>
  </form>
</div>

{% for g in groups %}
  <div class="card mb-3">
    <div class="card-header d-flex justify-content-between align-items-center">
      <div>
        <strong>{{ g.name }}</strong>
        <span class="text-muted">({{ g.members_count }} members)</span>
      </div>
    </div>
    <div class="card-body">
      <p class="text-muted small mb-3">
        Tip: assign multiple groups to users to combine access (RBAC + business/project access groups).
      </p>
      <form method="post" action="{% url 'administration:group-permissions' g.id %}">{% csrf_token %}
        <div class="accordion" id="permissions-{{ g.id }}">
          {% for section in permission_sections %}
            <div class="accordion-item">
              <h2 class="accordion-header" id="heading-{{ g.id }}-{{ forloop.counter }}">
                <button class="accordion-button {% if not forloop.first %}collapsed{% endif %}" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ g.id }}-{{ forloop.counter }}">
                  {{ section.title }}
                </button>
              </h2>
              <div id="collapse-{{ g.id }}-{{ forloop.counter }}" class="accordion-collapse collapse {% if forloop.first %}show{% endif %}" data-bs-parent="#permissions-{{ g.id }}">
                <div class="accordion-body">
                  <div class="row row-cols-1 row-cols-md-2 g-1">
                    {% for p in section.permissions %}
                      <div class="col">
                        <label class="form-check-label">
                          <input class="form-check-input me-2" type="checkbox" name="permission_ids" value="{{ p.id }}" {% if p in g.permissions.all %}checked{% endif %}>
                          <span class="small"><code>{{ p.content_type.app_label }}</code> Â· {{ p.codename }}</span>
                        </label>
                      </div>
                    {% endfor %}
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
        <div class="mt-3">
          <button class="btn btn-success">Save permissions</button>
        </div>
      </form>
    </div>
  </div>
{% endfor %}

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
